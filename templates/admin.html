<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <style>
        body {
            text-align: center; /* Align text center */
            margin-top: 170px; /* Add margin to the top */
        }

        .admin-box {
            background-color: gray; /* Pink background color */
            padding: 20px; /* Add padding */
            border-radius: 10px; /* Add border radius */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* Add box shadow */
            display: inline-block; /* Display as inline-block to fit content */
            margin-right: 20px;
        }

        .admin-details {
            display: inline-block; /* Display as inline-block */
            vertical-align: top; /* Align to the top */
            width: calc(50% - 200px); /* Set width */
            margin-right: 10px; /* Reduce margin to the right */
            margin-bottom: 20px; /* Add margin to the bottom */
        }

        h1 {
            font-weight: bold; /* Make heading bold */
        }

        .button-container {
            display: flex;
            flex-direction: column; /* Display buttons vertically */
            align-items: center; /* Align buttons in the center horizontally */
            margin-top: 30px; /* Add margin to the top of the button container */
        }

        .button-container button {
            margin: 10px; /* Add margin around the buttons */
            padding: 10px 20px; /* Add padding to the buttons */
            width: 250px; /* Set fixed width */
            height: 40px;
            font-size: 16px; /* Adjust font size */
            border: 1px solid #555; /* Add border */
            border-radius: 5px; /* Add border radius */
            background-color: #f5f5f5; /* Add background color */
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); /* Add box shadow for 3D effect */
            transition: box-shadow 0.3s ease; /* Add transition for smooth effect */
        }

        .button-container button:hover {
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5); /* Adjust box shadow on hover for 3D effect */
        }
    </style>
</head>

<body>
    <div class="admin-details">
        <div class="admin-box">
            <h1>User Details</h1> 
            <!-- Button container for Add, Update, Delete buttons -->
            <div class="button-container">
                <!-- Button to add a new user -->
                <button onclick="openAddUserForm();">Add User</button>
                <!-- Button to delete an existing user -->
                <button onclick="openDeleteUserForm();">Delete User</button>
                <!-- Button to display user details -->
                <button onclick="displayUserDetails();">Display User Details</button>
            </div>
        </div>
    </div>

    <!-- Hidden form for adding a new user -->
    <form id="addUserForm" style="display: none;">
        <input type="text" id="mobileNumber" placeholder="Mobile Number" required>
        <input type="text" id="firstName" placeholder="First Name" required>
        <input type="text" id="middleName" placeholder="Middle Name">
        <input type="text" id="lastName" placeholder="Last Name" required>
        <input type="password" id="password" placeholder="Password" required>
        <select id="gender" required>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
            <option value="non-binary">Non-binary</option>
            <option value="prefer not to say">Prefer not to say</option>
        </select>
        <input type="date" id="dateOfBirth" required>
        <button onclick="addUser();" type="button">Submit</button>
    </form>

    <!-- Hidden form for updating an existing user -->
    <form id="updateUserForm" style="display: none;">
        <input type="number" id="userIdToUpdate" placeholder="User ID to Update" required>
        <input type="text" id="newFirstName" placeholder="New First Name">
        <input type="text" id="newMiddleName" placeholder="New Middle Name">
        <input type="text" id="newLastName" placeholder="New Last Name">
        <input type="password" id="newPassword" placeholder="New Password">
        <select id="newGender">
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
            <option value="non-binary">Non-binary</option>
            <option value="prefer not to say">Prefer not to say</option>
        </select>
        <input type="date" id="newDateOfBirth">
        <button onclick="updateUser();">Submit</button>
    </form>

    <!-- Hidden form for deleting an existing user -->
    <form id="deleteUserForm" style="display: none;">
        <input type="number" id="userIdToDelete" placeholder="User ID to Delete" required>
        <button onclick="deleteUser();">Submit</button>
    </form>

    <!-- HERE PRODUCT FORMS START -->
    <form id="addProductForm" style="display: none;">
        <input type="text" id="productName" placeholder="Product Name" required>
        <input type="text" id="unitOfMeasure" placeholder="Unit of Measure">
        <input type="number" id="quantityPerUnit" placeholder="Quantity Per Unit" required>
        <input type="number" id="availableUnits" placeholder="Available Units" required>
        <input type="number" id="mrp" placeholder="MRP" required>
        <input type="number" id="sellingPrice" placeholder="Selling Price" required>
        <input type="text" id="manufacturerName" placeholder="Manufacturer Name">
        <input type="text" id="productDescription" placeholder="Product Description">

        <select id="categoryID" required>
            <option value="1">Electronics</option>
            <option value="2">Food</option>
            <option value="3">Medical</option>
            <option value="4">Bathroom</option>
            <option value="5">Fruits & Vegetables</option>
        </select>

        <button onclick="addProduct();" type="button">Submit</button>
    </form>

    <form id="updateProductForm" style="display: none;">
        <input type="number" id="productID" placeholder="ID to update" required>
        <input type="text" id="productName2" placeholder="Product Name" required>
        <input type="text" id="unitOfMeasure2" placeholder="Unit of Measure">
        <input type="number" id="quantityPerUnit2" placeholder="Quantity Per Unit" required>
        <input type="number" id="availableUnits2" placeholder="Available Units" required>
        <input type="number" id="mrp2" placeholder="MRP" required>
        <input type="number" id="sellingPrice2" placeholder="Selling Price" required>
        <input type="text" id="manufacturerName2" placeholder="Manufacturer Name">
        <input type="text" id="productDescription2" placeholder="Product Description">

        <select id="categoryID2" required>
            <option value="1">Electronics</option>
            <option value="2">Food</option>
            <option value="3">Medical</option>
            <option value="4">Bathroom</option>
            <option value="5">Fruits & Vegetables</option>
        </select>

        <button onclick="updateProduct();" type="button">Submit</button>
    </form>

    <form id="deleteProductForm" style="display: none;">
        <input type="number" id="productIdToDelete" placeholder="Product ID to Delete" required>
        <button onclick="deleteProduct();" type = "button">Submit</button>
    </form>
    


    <!-- product form ends ---------------------- -->


    <div class="admin-details">
        <div class="admin-box">
            <h1>Product Details</h1>
            <div class="button-container">
                <button onclick="openAddProductForm();">Add Product</button>
                <button onclick="openUpdateProductForm();">Update Product Details</button>
                <button onclick="openDeleteProductForm();">Delete Product</button>
                <button onclick="displayProductDetails();">Display Product Details</button>
            </div>
        </div>
        <!-- Hidden forms for product operations -->
        <!-- Add, update, delete product forms -->
    </div>
    <div id="userDetails">
        <!-- Display user details here -->

    </div>
    <div id="productDetails">
        <!-- Display product details here -->

    </div>


    <script>
        function openAddUserForm() {
            // Hide other forms and display the Add User form
            document.getElementById("addUserForm").style.display = "block";
            document.getElementById("updateUserForm").style.display = "none";
            document.getElementById("deleteUserForm").style.display = "none";
        }

        function openUpdateUserForm() {
            // Hide other forms and display the Update User form
            document.getElementById("addUserForm").style.display = "none";
            document.getElementById("updateUserForm").style.display = "block";
            document.getElementById("deleteUserForm").style.display = "none";
        }

        function openDeleteUserForm() {
            // Hide other forms and display the Delete User form
            document.getElementById("addUserForm").style.display = "none";
            document.getElementById("updateUserForm").style.display = "none";
            document.getElementById("deleteUserForm").style.display = "block";
        }

        function addUser() {
            var mobileNumber = document.getElementById("mobileNumber").value;
            var firstName = document.getElementById("firstName").value;
            var middleName = document.getElementById("middleName").value;
            var lastName = document.getElementById("lastName").value;
            var password = document.getElementById("password").value;
            var gender = document.getElementById("gender").value;
            var dateOfBirth = document.getElementById("dateOfBirth").value;

            fetch('/add_user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    mobile_number: mobileNumber,
                    first_name: firstName,
                    middle_name: middleName,
                    last_name: lastName,
                    password_hash: password,
                    gender: gender,
                    date_of_birth: dateOfBirth
                }),
            })
                .then(response => {
                    if (response.ok) {
                        alert('User added successfully');
                        window.location.href = "/admin";
                    } else {
                        alert('Failed to add user');
                    }
                    return response.json(); // Parse response JSON asynchronously
                })
                .then(data => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }

        function deleteUser() {
            var userIdToDelete = document.getElementById("userIdToDelete").value;

            // Make AJAX request to delete user
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/delete_user", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    alert(xhr.responseText); // Show success message
                    window.location.href = "/admin";
                }
            };
            var userData = JSON.stringify({
                user_id: userIdToDelete
            });
            xhr.send(userData);
        }
        // Product details functions
        function openAddProductForm() {
            document.getElementById("addProductForm").style.display = "block";
            document.getElementById("updateProductForm").style.display = "none";
            document.getElementById("deleteProductForm").style.display = "none";
        }

        function openUpdateProductForm() {
            // Hide other forms and display the Update Product form
            document.getElementById("addProductForm").style.display = "none";
            document.getElementById("updateProductForm").style.display = "block";
            document.getElementById("deleteProductForm").style.display = "none";
        }


        function openDeleteProductForm() {
            document.getElementById("deleteProductForm").style.display = "block";
            document.getElementById("addProductForm").style.display = "none";
            document.getElementById("updateProductForm").style.display = "none";
        }

        function addProduct() {
            var productID = document.getElementById("productID").value;
            var productName = document.getElementById("productName").value;
            var unitOfMeasure = document.getElementById("unitOfMeasure").value;
            var quantityPerUnit = document.getElementById("quantityPerUnit").value;
            var availableUnits = document.getElementById("availableUnits").value;
            var mrp = document.getElementById("mrp").value;
            var sellingPrice = document.getElementById("sellingPrice").value;
            var manufacturerName = document.getElementById("manufacturerName").value;
            var productDescription = document.getElementById("productDescription").value;
            var selectCategory = document.getElementById("categoryID");
            var categoryID = selectCategory.options[selectCategory.selectedIndex].value;

            fetch('/add_product', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_ID: productID,
                    product_name: productName,
                    unit_of_measure: unitOfMeasure,
                    quantity_per_unit: quantityPerUnit,
                    available_units: availableUnits,
                    mrp: mrp,
                    selling_price: sellingPrice,
                    manufacturer_name: manufacturerName,
                    product_description: productDescription,
                    category_ID: categoryID
                }),
            })
                .then(response => {
                    if (response.ok) {
                        alert('Product added successfully');
                        window.location.href = "/admin";
                    } else {
                        alert('Failed to add product');
                    }
                    return response.json(); // Parse response JSON asynchronously
                })
                .then(data => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });    
        }

        function deleteProduct() {
            var productIdToDelete = document.getElementById("productIdToDelete").value;

            // Make AJAX request to delete user
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/delete_product", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    alert(xhr.responseText); // Show success message
                }
            };
            var productData = JSON.stringify({
                product_id: productIdToDelete
            });
            xhr.send(productData);
        }

        function updateProduct() {
            var productID = document.getElementById("productID").value;
            var productName = document.getElementById("productName2").value;
            var unitOfMeasure = document.getElementById("unitOfMeasure2").value;
            var quantityPerUnit = document.getElementById("quantityPerUnit2").value;
            var availableUnits = document.getElementById("availableUnits2").value;
            var mrp = document.getElementById("mrp2").value;
            var sellingPrice = document.getElementById("sellingPrice2").value;
            var manufacturerName = document.getElementById("manufacturerName2").value;
            var productDescription = document.getElementById("productDescription2").value;
            var selectCategory = document.getElementById("categoryID2");
            var categoryID = selectCategory.options[selectCategory.selectedIndex].value;

            fetch('/update_product', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_ID: productID,
                    product_name: productName,
                    unit_of_measure: unitOfMeasure,
                    quantity_per_unit: quantityPerUnit,
                    available_units: availableUnits,
                    mrp: mrp,
                    selling_price: sellingPrice,
                    manufacturer_name: manufacturerName,
                    product_description: productDescription,
                    category_ID: categoryID
                }),
            })
                .then(response => {
                    if (response.ok) {
                        alert('Product updated successfully');
                        window.location.href = "/admin";
                    } else {
                        alert('Failed to update product');
                    }
                    return response.json(); // Parse response JSON asynchronously
                })
                .then(data => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });   

        }
    </script>

    <script>
        function displayUserDetails() {
            // Make AJAX request to display user details
            fetch('/display_user', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => {
                    if (response.ok) {
                        alert('User details displayed successfully');
                        return response.json(); // Parse response JSON asynchronously
                    } else {
                        throw new Error('Failed to display user details');
                    }
                })
                .then(data => {
                    let userDetailsHtml = ''; // String to store user details HTML
                    data.forEach(user => {
                        // Construct HTML for each user and append to userDetailsHtml
                        userDetailsHtml += `<p><b>ID:</b> ${user.id}   <b>Name:</b> ${user.first_name} ${user.last_name}   <b>Phone Number:</b> ${user.mobile_number}</p>`;
                    });
                    document.getElementById("userDetails").innerHTML = userDetailsHtml; // Update user details container
    
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('Failed to display user details'); // Show error message
                });
        }

        function displayProductDetails() {
            // Make AJAX request to display user details
            fetch('/display_product', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => {
                    if (response.ok) {
                        alert('Product details displayed successfully');
                        return response.json(); // Parse response JSON asynchronously
                    } else {
                        throw new Error('Failed to display product details');
                    }
                })
                .then(data => {
                    let productDetailsHtml = ''; // String to store product details HTML
                    data.forEach(product => {
                        // Construct HTML for each product and append to productDetailsHtml
                        productDetailsHtml += `<p><b>ID:</b> ${product.id} <b>Product:</b> ${product.product_name}   <b>Stock: ${product.available_units}</b>   <b>Price:</b> Rs.${product.selling_price}</p>`;
                    });
                    document.getElementById("productDetails").innerHTML = productDetailsHtml; // Update product details container
    
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('Failed to display product details'); // Show error message
                });
        }
    </script>
    
</body>

</html>